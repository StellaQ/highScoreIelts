<!--pages/detailAdvanced/detailAdvanced.wxml-->
<view class="containerAdvanced {{state === 0 ? 'state0' : state === 1 ? 'state1' : state === 2 ? 'state2' : ''}}">
  <!-- 头部信息 -->
  <view class="header">
    <view class="topic-title">
      <view>
        <text class="topic-name">{{topicName}}</text>
      </view>
      <view class="topic-status {{state === 0 ? 'status-new' : state === 1 ? 'status-review' : state === 2 ? 'status-done' : ''}}">
        {{state === 0 ? '新题目' : state === 1 ? '待复习' : state === 2 ? '已复习' : ''}}
      </view>
    </view>
  </view>

  <!-- 问题列表 -->
  <view class="question-section">
    <block wx:if="{{state === 0}}">
      <view wx:for="{{questions}}" wx:key="index" class="question-card">
        <view class="question-title">{{item.qTitle}}</view>
        <view class="question-title-cn">{{item.qTitle_cn}}</view>
        <textarea class="answer-input" 
          placeholder="如果为空，就由AI自动补全[AI Generated]"
          value="{{ item.answerUser }}"
          data-index="{{index}}"
          maxlength="100"
          bindinput="onInputTextarea" />
      </view> 
    </block>
    <block wx:if="{{state === 1}}">
      <view class="question-points">
        <view class="question-point" wx:for="{{questions}}" wx:key="index">
          * {{item.qTitle}}
        </view>
      </view>
      <view class="question-card {{isFlipped ? 'flipped' : ''}}" bindtap="onCardTap">
        <view class="card-inner">
          <view class="card-front">
            <view class="question-tip">smile & fluent & no repetition</view>
          </view>
          <view class="card-back">
            <text class="answer-content" user-select="true">
              {{answerAI.opening}}
            </text>
            <text class="answer-content" user-select="true">
              {{answerAI.body}}
            </text>
            <text class="answer-content" user-select="true">
              {{answerAI.closing}}
            </text>
          </view>
        </view>
      </view>
    </block>
  </view>
  <view wx:if="{{state === 0}}"
    style="width: 100%; margin: 14px 0; display: flex; flex-direction: flex-end;">
    <button class="submit-btn"
      bindtap="onSubmitAnswer">AI定制答案</button>
  </view>
  <view wx:if="{{state === 0 && (answerAI.opening || answerAI.body || answerAI.closing)}}"
   class="ai-feedback">
    <view class="ai-feedback-content" wx:if="{{answerAI.opening}}">
      {{answerAI.opening}}
    </view>
    <view class="ai-feedback-content" wx:if="{{answerAI.body}}">
      {{answerAI.body}}
    </view>
    <view class="ai-feedback-content" wx:if="{{answerAI.closing}}">
      {{answerAI.closing}}
    </view>
  </view>
  <!-- 复习时间选择 -->
  <view wx:if="{{questions.length>0}}" class="review-section">
    <text class="review-title">选择下次复习时间</text>
    <view class="review-options">
      <view class="review-option {{selectedTime === '1' ? 'selected' : ''}}" bindtap="onSelectTime" data-time="1">1天</view>
      <view class="review-option {{selectedTime === '3' ? 'selected' : ''}}" bindtap="onSelectTime" data-time="3">3天</view>
      <view class="review-option {{selectedTime === '7' ? 'selected' : ''}}" bindtap="onSelectTime" data-time="7">7天</view>
      <view class="review-option {{selectedTime === '15' ? 'selected' : ''}}" bindtap="onSelectTime" data-time="15">15天</view>
      <view class="review-option {{selectedTime === 'done' ? 'selected' : ''}}" bindtap="onSelectTime" data-time="done">已掌握</view>
    </view>
    <view class="next-review-time">{{nextReviewText}}</view>
    <button class="confirm-btn" disabled="{{!nextReviewDate}}" bindtap="onConfirmTime">确认</button>
  </view>
</view>